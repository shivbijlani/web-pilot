# Copilot Instructions for web-pilot Development

## Testing web-pilot

### Testing Workflow (AUTOMATED)

When testing web-pilot changes, use this workflow:

#### First Run (Profile Selection)
1. Run profile selection mode:
   ```powershell
   node src/cli.js --select-profile
   ```
2. User selects their profile
3. Preferences are saved to `.web-pilot-prefs.json`
4. Process exits (no browser launch)

#### Subsequent Runs (Background Testing)
After profile is selected once, run with --background flag:

```powershell
node src/cli.js --background
```

The tool will:
- Auto-load saved browser and profile preferences
- Skip profile selection prompt  
- Detach and run in background
- Show PID in output
- Write logs to web-pilot.log
- Keep terminal free for sending commands

**This is the recommended way for Copilot/LLM testing!**

#### Testing Commands
```bash
# Write command
"goto:https://example.com" | Out-File -FilePath command.txt -Encoding utf8 -NoNewline

# Wait and read result
Start-Sleep -Seconds 2; Get-Content result.txt

# Execute JavaScript
"execute:document.title" | Out-File -FilePath command.txt -Encoding utf8 -NoNewline
Start-Sleep -Seconds 2; Get-Content result.txt
```

#### Verify Background Process is Running
```powershell
# Check node processes
Get-Process -Name node -ErrorAction SilentlyContinue

# Check logs for PID and status
Get-Content web-pilot.log
```

#### Stop Background Process
```powershell
# Kill all node/edge processes
Stop-Process -Name node -Force -ErrorAction SilentlyContinue
Stop-Process -Name msedge -Force -ErrorAction SilentlyContinue

# Or use the helper script
.\stop-background.ps1
```

#### Reset Preferences
If user wants to select a different profile:
```powershell
Remove-Item .web-pilot-prefs.json
```
Then run first-time setup again.

### Command Writing Pattern
Always use this pattern:
```bash
"<command>" | Out-File -FilePath command.txt -Encoding utf8 -NoNewline
```

Never use:
```bash
echo "<command>" > command.txt  # This adds BOM and newlines
```

## Development Workflow

1. **Code changes**: Make changes to src/ files
2. **Commit & push**: Commit changes to git
3. **First-time setup**: Run normally once, let user select profile
4. **Testing**: Run in background with saved preferences
5. **Verify**: Write commands and read results

## Summary
- ✅ First run: Normal mode for profile selection
- ✅ Save preferences to `.web-pilot-prefs.json`
- ✅ Subsequent runs: Background mode with auto-loaded preferences
- ✅ Use VS Code terminal for command writing and result reading
- ✅ Reset preferences file to change profile

